;/*FB_PKG_DELIM*/

__d("LSHandleFTSIndexProtobufMessageResponse",["LSArrayGetObjectAt","LSDecryptMessageProtobufs","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSRestoreProtobufs.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][handleFTSIndexProtobufMessageResponse] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=new c.Map(),c.storedProcedure(b("LSDecryptMessageProtobufs"),a[0],a[2]).then(function(a){return a=a,d[3]=a[0],d[4]=a[1],a})},function(e){return d[5]=a[3].get("restore_task_source"),d[6]=a[3].get("request_id"),c.i64.neq(a[4],void 0)?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[20]=new c.Map(),d[20].set("error_msg","Expected a nonempty query result"),d[20].set("code",c.i64.cast([0,3])),d[20].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[21]=c.createArray(),d[22]=(d[21].push(d[20]),d[21]),e=[void 0,d[21]],d[14]=e[0],d[15]=e[1],e):(b=a.item,d[20]=new c.Map(),d[20].set("backup_id",b.backupId),d[20].set("device_public_key_blob",b.devicePublicKeyBlob),d[20].set("device_private_key_blob",b.devicePrivateKeyBlob),d[20].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[20].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[20].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[20].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[20].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[20].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[20].set("orf_client_state_v2_blob",void 0),d[20].set("orf_v2_authority_level",void 0),d[20].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[20].set("device_id",b.deviceId),d[20].set("backup_tenancy",b.backupTenancy),d[20].set("encryption_version",b.encryptionVersion),d[20].set("revision_version",b.revisionVersion),d[20].set("initialize_restore_result",void 0),d[20].set("authority_level",b.authorityLevel),e=[d[20],void 0],d[14]=e[0],d[15]=e[1],e)})},function(e){return d[17]=new c.Map(),d[17].set("value",d[14]),d[17].set("errors",d[15]),d[18]=d[17].get("value"),d[18]!==void 0?c.sequence([function(e){return d[20]=d[18].get("backup_id"),d[21]=d[18].get("device_public_key_blob"),d[22]=d[18].get("device_private_key_blob"),d[23]=d[18].get("epoch_storage_public_key_blob"),d[24]=d[18].get("epoch_storage_private_key_blob"),d[25]=d[18].get("epoch_auth_public_key_blob"),d[26]=d[18].get("epoch_auth_private_key_blob"),d[27]=d[18].get("mailbox_root_key_blob"),d[28]=d[18].get("ocmf_client_state_blob"),d[29]=d[18].get("orf_client_state_v2_blob"),d[30]=d[18].get("orf_v2_authority_level"),d[31]=d[18].get("oblivious_validation_token_blob"),d[32]=d[18].get("device_id"),d[33]=d[18].get("backup_tenancy"),d[34]=d[18].get("encryption_version"),d[35]=d[18].get("revision_version"),d[36]=d[18].get("initialize_restore_result"),d[37]=d[18].get("authority_level"),c.i64.neq(d[32],void 0)?c.sequence([function(a){return d[39]=void 0,c.i64.neq(d[39],void 0)?c.resolve(d[40]=d[39]):c.sequence([function(a){return d[43]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[53]=(d[43].push(c.i64.cast([0,0])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[53]=(d[43].push(c.i64.cast([0,2])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[53]=(d[43].push(c.i64.cast([0,3])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[53]=(d[43].push(c.i64.cast([0,4])),d[43]):0,d[48]=c.createArray(),d[49]=c.i64.of_int32(d[43].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[53]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[43],d[53]).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[56]=(d[48].push(d[54]),d[48])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[53]=c.createArray(),d[54]=c.i64.of_int32(d[48].length),c.i64.gt(d[54],c.i64.cast([0,0]))?c.loopAsync(d[54],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[48],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[53].push(c.i64.to_string(d[57])),d[53])}])}):c.resolve()},function(a){return d[55]=d[53].join(","),d[50]=d[55]}])},function(a){return d[48].some(function(a){return c.i64.eq(d[34],a)})?d[51]=d[34]:d[51]=void 0,c.i64.neq(d[51],void 0)?d[52]=d[51]:d[52]=void 0,d[40]=d[52]}])},function(b){return c.i64.neq(d[40],void 0)?d[41]=d[40]:d[41]=c.i64.cast([0,0]),c.i64.neq(d[33],void 0)?d[42]=d[33]:d[42]=c.i64.cast([0,1]),d[38]=c.i64.neq(d[32],a[4])}]):c.resolve(d[38]=!1)},function(a){return d[19]=d[38]}]):c.resolve((d[20]=d[17].get("errors"),d[21]=d[17].get("errors"),d[19]=!1))},function(a){return d[7]=d[19]}]):c.resolve(d[7]=!1)},function(e){return d[7]?c.resolve(0):c.sequence([function(e){return d[3]!==void 0?c.sequence([function(e){return d[15]=a[1].get("has_more_before"),d[16]=a[1].get("has_more_after"),d[15]?(d[24]=a[1].get("next_message_timestamp_ms_before"),d[17]=d[24]):d[17]=void 0,d[16]?(d[24]=a[1].get("next_message_timestamp_ms_after"),d[18]=d[24]):d[18]=void 0,d[19]=a[1].get("has_more_before"),d[20]=a[1].get("has_more_after"),d[21]=a[3].get("request_id"),d[22]=a[3].get("reference_timestamp"),d[23]=c.createArray(),c.nativeOperation(b("LSRestoreProtobufs.nop"),a[2],d[3],d[19],d[17],d[20],d[18],!1,d[21],d[22],a[5],d[23],d[5],void 0)},function(a){return d[14]=void 0}]):c.resolve((d[4]!==void 0?(d[15]=d[4].get("error_code"),c.i64.eq(d[15],c.i64.cast([0,1]))?0:0):0,d[14]=d[4]))},function(e){return d[14]!==void 0?c.sequence([function(b){return d[15]=a[3].get("request_id"),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[23]=new c.Map(),d[23].set("error_msg","Expected a nonempty query result"),d[23].set("code",c.i64.cast([0,3])),d[23].set("src_line","MEBClientStateUtils.php:244 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[24]=c.createArray(),d[25]=(d[24].push(d[23]),d[24]),e=[void 0,d[24]],d[16]=e[0],d[17]=e[1],e):(b=a.item,d[23]=new c.Map(),d[23].set("backup_id",b.backupId),d[23].set("device_public_key_blob",b.devicePublicKeyBlob),d[23].set("device_private_key_blob",b.devicePrivateKeyBlob),d[23].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[23].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[23].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[23].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[23].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[23].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[23].set("orf_client_state_v2_blob",void 0),d[23].set("orf_v2_authority_level",void 0),d[23].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[23].set("device_id",b.deviceId),d[23].set("backup_tenancy",b.backupTenancy),d[23].set("encryption_version",b.encryptionVersion),d[23].set("revision_version",b.revisionVersion),d[23].set("initialize_restore_result",void 0),d[23].set("authority_level",b.authorityLevel),e=[d[23],void 0],d[16]=e[0],d[17]=e[1],e)})},function(a){return d[19]=new c.Map(),d[19].set("value",d[16]),d[19].set("errors",d[17]),d[20]=d[19].get("value"),d[20]!==void 0?c.sequence([function(a){return d[23]=d[20].get("backup_id"),d[24]=d[20].get("device_public_key_blob"),d[25]=d[20].get("device_private_key_blob"),d[26]=d[20].get("epoch_storage_public_key_blob"),d[27]=d[20].get("epoch_storage_private_key_blob"),d[28]=d[20].get("epoch_auth_public_key_blob"),d[29]=d[20].get("epoch_auth_private_key_blob"),d[30]=d[20].get("mailbox_root_key_blob"),d[31]=d[20].get("ocmf_client_state_blob"),d[32]=d[20].get("orf_client_state_v2_blob"),d[33]=d[20].get("orf_v2_authority_level"),d[34]=d[20].get("oblivious_validation_token_blob"),d[35]=d[20].get("device_id"),d[36]=d[20].get("backup_tenancy"),d[37]=d[20].get("encryption_version"),d[38]=d[20].get("revision_version"),d[39]=d[20].get("initialize_restore_result"),d[40]=d[20].get("authority_level"),c.i64.neq(d[35],void 0)?c.sequence([function(a){return d[42]=void 0,c.i64.neq(d[42],void 0)?c.resolve(d[43]=d[42]):c.sequence([function(a){return d[46]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[56]=(d[46].push(c.i64.cast([0,0])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[56]=(d[46].push(c.i64.cast([0,2])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[56]=(d[46].push(c.i64.cast([0,3])),d[46]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[56]=(d[46].push(c.i64.cast([0,4])),d[46]):0,d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[51].push(d[57]),d[51])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[56]=c.createArray(),d[57]=c.i64.of_int32(d[51].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[59]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],d[59]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return d[62]=(d[56].push(c.i64.to_string(d[60])),d[56])}])}):c.resolve()},function(a){return d[58]=d[56].join(","),d[53]=d[58]}])},function(a){return d[51].some(function(a){return c.i64.eq(d[37],a)})?d[54]=d[37]:d[54]=void 0,c.i64.neq(d[54],void 0)?d[55]=d[54]:d[55]=void 0,d[43]=d[55]}])},function(a){return c.i64.neq(d[43],void 0)?d[44]=d[43]:d[44]=c.i64.cast([0,0]),c.i64.neq(d[36],void 0)?d[45]=d[36]:d[45]=c.i64.cast([0,1]),d[41]=d[35]}]):c.resolve(d[41]=void 0)},function(a){return d[21]=d[41]}]):c.resolve((d[23]=d[19].get("errors"),d[24]=d[19].get("errors"),d[21]=void 0))},function(b){return d[22]=a[3].get("restore_task_source")}]):c.resolve()}])},function(a){return d[8]=c.i64.of_float(Date.now()),d[9]=c.i64.random(),d[11]="Finishing execution. Execution time: ",d[12]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[13]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][handleFTSIndexProtobufMessageResponse] ",d[10],d[11],d[10],d[12],d[10],d[13]].join("")),c.i64.eq(c.i64.mod_(d[9],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[14]=",",d[15]=c.createArray(),void 0!==void 0?d[16]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"handleFTSIndexProtobufMessageResponse",[d[11],d[14],d[12],d[14],d[13]].join(""),d[15],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleFTSIndexProtobufMessageResponseStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);